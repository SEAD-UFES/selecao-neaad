
function buscarCEP(c,b,d,a,e){if(isChamadaRepetida(d)){if(!vazioOuNulo($("#erroAnterior"+d).val())){$("#nrCep"+d+"Erro").show()}else{if($("#"+b).is(":hidden")){$("#"+b).show();$($("#foco"+d).val()).focus()}}return}$("#nrCep"+d+"Erro").hide();$("#erroAnterior"+d).val("");$("#"+b).hide();$("#"+c).show();$.ajax({type:"POST",url:getURLServidor()+"/controle/CTAjax.php",data:{buscacep:$("#nrCep"+d).val().replace(/\.|-|_/g,"")},dataType:"json",success:function(g){if(g!=null&&g.resultado==1){$("#idEstado"+d).val(unescape(g.uf));a(unescape(g.id_cidade));if(!vazioOuNulo(g.logradouro)){var h=unescape(g.tp_logradouro)+" "+unescape(g.logradouro);var f=separaNumero(h);$("#nmLogradouro"+d).val(f[0]);$("#nmBairro"+d).val(unescape(g.bairro));if(vazioOuNulo(f[1])){$("#dsComplemento"+d).val("");$("#foco"+d).val("#nrNumero"+d);$("#nrNumero"+d).val("").focus()}else{$("#foco"+d).val("#dsComplemento"+d);$("#nrNumero"+d).val(f[1]);$("#dsComplemento"+d).val("").focus()}}else{$("#foco"+d).val("#nmLogradouro"+d);$("#nrNumero"+d).val("");$("#nmBairro"+d).val("");$("#dsComplemento"+d).val("");$("#nmLogradouro"+d).val("").focus()}e();$("#"+c).hide();$("#"+b).show()}else{$("#"+c).hide();$("#"+b).hide();$("#nrCep"+d+"Erro").html("CEP inválido");$("#nrCep"+d+"Erro").show();$("#erroAnterior"+d).val("true")}},error:function(i,f,g){var h="Desculpe, ocorreu um erro ao tentar uma requisição ao servidor.\nPor favor, recarregue a página.\n\n";h+="Detalhes do erro: "+i.status+" - "+g;$("#nrCep"+d+"Erro").hide();$("#"+c).hide();$("#"+b).hide();alert(h)}})}function adicionaGatilhoAjaxCep(c,b,d,a,e){if(!vazioOuNulo($("#nrCep"+d).val())&&(habilitaBuscaCep($("#nrCep"+d).val()))){$("#cepAnterior"+d).val($("#nrCep"+d).val());$("#"+b).show()}gatilho=function(){if(!vazioOuNulo($("#nrCep"+d).val())&&(habilitaBuscaCep($("#nrCep"+d).val()))){buscarCEP(c,b,d,a,e)}else{$("#nrCep"+d+"Erro").hide();$("#"+c).hide();$("#"+b).hide()}};$("#nrCep"+d).keydown(gatilho);$("#nrCep"+d).keyup(gatilho)}function habilitaBuscaCep(a){return a.replace(/\.|-|_/g,"").length==8}function isChamadaRepetida(a){if($("#cepAnterior"+a).val()!=$("#nrCep"+a).val()){$("#cepAnterior"+a).val($("#nrCep"+a).val());return false}return true}function separaNumero(b){var a=b.indexOf(",");if(a==-1){return[b,""]}return[b.substring(0,a).trim(),b.substring(a+1).trim()]};